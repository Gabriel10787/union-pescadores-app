<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ£ ClasificaciÃ³n Pesca - UPP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="description" content="AplicaciÃ³n de gestiÃ³n de concursos de pesca - UniÃ³n de Pescadores de Plasencia" />
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="logo.jpg" />
  <link rel="apple-touch-icon" href="logo.jpg" />
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.webmanifest" />
  
  <!-- Meta tags para PWA -->
  <meta name="theme-color" content="#44c4a1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="UPP Pesca" />
  
  <!-- Google Fonts - Inter (fuente profesional) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="app-wrapper">
    <header class="app-header">
      <button id="btn-theme-toggle" class="btn-theme-toggle" title="Cambiar tema">
        ğŸŒ™
      </button>
      <img src="logo.jpg" alt="Logo UPP" class="header-logo" />
      <div class="title-group">
        <h1>UniÃ³n de Pescadores de Plasencia</h1>
        <p class="subtitle">GestiÃ³n de concursos</p>
      </div>
      <div class="header-buttons">
        <button id="btn-menu" class="btn-menu-header">
          â˜° MenÃº
        </button>
      </div>
    </header>

    <!-- MenÃº desplegable -->
    <nav id="menu-desplegable" class="menu-desplegable" style="display: none;">
      <div class="menu-overlay" id="menu-overlay"></div>
      <div class="menu-content">
        <div class="menu-header">
          <h3>ğŸ“‹ MenÃº de GestiÃ³n</h3>
          <button id="btn-cerrar-menu" class="btn-cerrar-menu">âœ•</button>
        </div>
        <ul class="menu-lista">
          <li>
            <button id="menu-ranking-individual" class="menu-item">
              ğŸ† Ranking Individual
            </button>
          </li>
          <li>
            <button id="menu-exportar-individual" class="menu-item">
              ğŸ’¾ Exportar ClasificaciÃ³n Individual
            </button>
          </li>
          <li>
            <button id="menu-imprimir-individual" class="menu-item">
              ğŸ–¨ï¸ Imprimir ClasificaciÃ³n Individual
            </button>
          </li>
          <li>
            <button id="menu-ranking-equipos" class="menu-item">
              ğŸ… Ranking Equipos Temporada
            </button>
          </li>
          <li>
            <button id="menu-exportar-equipos" class="menu-item">
              ğŸ’¾ Exportar ClasificaciÃ³n Equipos
            </button>
          </li>
          <li>
            <button id="menu-imprimir-equipos" class="menu-item">
              ğŸ–¨ï¸ Imprimir ClasificaciÃ³n Equipos
            </button>
          </li>
          <li>
            <button id="menu-gestionar-equipos" class="menu-item">
              ğŸ¤ Gestionar Equipos
            </button>
          </li>
          <li style="border-top: 2px solid var(--accent); margin-top: 8px; padding-top: 8px;">
            <button id="menu-admin" class="menu-item menu-item-admin">
              ğŸ” Modo Administrador
            </button>
          </li>
        </ul>
      </div>
    </nav>

    <!-- Modal de login administrador -->
    <div id="modal-admin" class="modal-admin" style="display: none;">
      <div class="modal-overlay" id="modal-admin-overlay"></div>
      <div class="modal-admin-content">
        <div class="modal-admin-header">
          <h3>ğŸ” Acceso Administrador</h3>
          <button id="btn-cerrar-modal-admin" class="btn-cerrar-menu">âœ•</button>
        </div>
        <div class="modal-admin-body">
          <p id="admin-status-text">Introduce la contraseÃ±a de administrador</p>
          <input type="password" id="input-password-admin" placeholder="ContraseÃ±a" />
          <button id="btn-login-admin" class="btn-primary">Acceder</button>
          <button id="btn-recuperar-password" class="btn-secondary" style="margin-top: 8px; width: 100%;">
            ğŸ”‘ Â¿Olvidaste tu contraseÃ±a?
          </button>
          <div id="admin-panel" style="display: none;">
            <div class="admin-info">
              <p>âœ… <strong>SesiÃ³n de administrador activa</strong></p>
              <button id="btn-logout-admin" class="btn-secondary">Cerrar sesiÃ³n</button>
            </div>
            <div class="admin-actions">
              <h4>GestiÃ³n de Concursos</h4>
              
              <!-- Formulario para crear concurso -->
              <div style="background: #f8f9fa; padding: 16px; border-radius: 8px; margin-bottom: 16px;">
                <h5 style="margin-bottom: 12px; font-size: 0.95rem;">â¡ï¸ Crear nuevo concurso</h5>
                <div class="form-group" style="margin-bottom: 12px;">
                  <label for="fecha-concurso">Fecha del concurso (DD/MM/AAAA) *</label>
                  <input type="text" id="fecha-concurso" placeholder="14/01/2026" pattern="\d{2}/\d{2}/\d{4}" required style="width: 100%;" />
                </div>
                <div class="form-group" style="margin-bottom: 12px;">
                  <label for="temporada">Temporada (aÃ±o) *</label>
                  <input type="number" id="temporada" min="2000" max="2100" style="width: 100%;" />
                </div>
                <div class="form-group" style="margin-bottom: 12px;">
                  <label for="nombre-concurso">Nombre del concurso</label>
                  <input type="text" id="nombre-concurso" placeholder="Ej: Concurso de Primavera" style="width: 100%;" />
                </div>
                <div class="form-group" style="margin-bottom: 12px;">
                  <label for="lugar-concurso">Lugar</label>
                  <input type="text" id="lugar-concurso" placeholder="Ej: RÃ­o JÃ©rtiga" style="width: 100%;" />
                </div>
                <div class="form-group" style="margin-bottom: 12px;">
                  <label for="hora-concurso">Hora de inicio</label>
                  <input type="time" id="hora-concurso" style="width: 100%;" />
                </div>
                <button id="btn-nuevo-concurso" class="btn-primary" style="width: 100%;">
                  âœ… AÃ±adir concurso
                </button>
              </div>
              
              <!-- GestiÃ³n de zonas del concurso -->
              <div id="zonas-concurso-section" style="display: none; background: #fff3cd; padding: 16px; border-radius: 8px; margin-bottom: 16px;">
                <h5 style="margin-bottom: 12px; font-size: 0.95rem;">ğŸ—ºï¸ Zonas del concurso activo</h5>
                <div class="zonas-config" style="margin-bottom: 12px;">
                  <input
                    type="text"
                    id="nueva-zona"
                    placeholder="Nombre de nueva zona (p.ej. Zona D)"
                    style="width: calc(100% - 110px); margin-right: 8px;"
                  />
                  <button id="btn-add-zona" class="btn-secondary" style="width: 100px;">â¡ï¸ AÃ±adir</button>
                </div>
                <div class="zonas-lista">
                  <label style="font-size: 0.85rem;">Zonas activas:</label>
                  <ul id="lista-zonas" style="margin-top: 8px;">
                    <!-- Se rellenarÃ¡ desde JS -->
                  </ul>
                  <small>Haz clic en una zona para eliminarla.</small>
                </div>
                <button id="btn-toggle-zonas-cerrar" class="btn-secondary" style="width: 100%; margin-top: 12px;">
                  âœ– Cerrar gestiÃ³n de zonas
                </button>
              </div>
              
              <button id="btn-toggle-zonas" class="btn-secondary" style="width: 100%; background: #f59e0b; border-color: #f59e0b; opacity: 0.5; cursor: not-allowed; margin-bottom: 16px;" disabled>
                ğŸ—ºï¸ Gestionar zonas del concurso
              </button>
              
              <!-- Lista de concursos existentes -->
              <div id="lista-concursos-admin"></div>
            </div>
            <div class="admin-actions">
              <h4>GestiÃ³n de Equipos</h4>
              <div id="lista-equipos-admin"></div>
            </div>
            <div class="admin-actions">
              <h4>ğŸ¯ Modo Zona (Multiusuario)</h4>
              <p style="font-size: 0.9rem; color: var(--text-muted); margin-bottom: 12px;">Activa una zona fija para trabajar mÃ¡s rÃ¡pido sin cambiar de zona en cada pesaje.</p>
              <div class="zona-mode-config">
                <div class="form-group">
                  <label for="zona-fija-select">Seleccionar zona fija</label>
                  <select id="zona-fija-select">
                    <option value="">Sin zona fija (manual)</option>
                  </select>
                </div>
                <button id="btn-activar-zona-fija" class="btn-secondary" style="width: 100%; margin-bottom: 8px;">
                  âœ… Activar modo zona
                </button>
                <button id="btn-desactivar-zona-fija" class="btn-danger" style="width: 100%; display: none;">
                  âŒ Desactivar modo zona
                </button>
              </div>
              <div id="zona-fija-info" class="zona-fija-activa" style="display: none; margin-top: 12px; padding: 12px; background: var(--accent); color: white; border-radius: 6px;">
                <p style="margin: 0;"><strong>ğŸŸ¢ Modo Zona Activo:</strong> <span id="zona-fija-nombre"></span></p>
                <small style="display: block; margin-top: 4px;">Todos los pesajes se registrarÃ¡n automÃ¡ticamente en esta zona.</small>
              </div>
            </div>
            <div class="admin-actions">
              <h4>Seguridad</h4>
              <button id="btn-cambiar-password" class="btn-secondary" style="width: 100%; margin-bottom: 12px;">
                ğŸ” Cambiar contraseÃ±a
              </button>
            </div>
            <div class="admin-actions">
              <h4>HistÃ³rico</h4>
              <button id="menu-borrar-historico" class="btn-danger" style="width: 100%;">
                ğŸ—‘ï¸ Borrar HistÃ³rico
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal de gestiÃ³n de equipos -->
    <div id="modal-equipos" class="modal-admin" style="display: none;">
      <div class="modal-overlay" id="modal-equipos-overlay"></div>
      <div class="modal-admin-content">
        <div class="modal-admin-header">
          <h3>ğŸ¤ GestiÃ³n de Equipos</h3>
          <button id="btn-cerrar-modal-equipos" class="btn-cerrar-menu">âœ•</button>
        </div>
        <div class="modal-admin-body">
          <div class="card-header" style="padding: 0; margin-bottom: 20px;">
            <p>Los equipos se comparten para toda la temporada. Gestiona los equipos que participan.</p>
          </div>

          <div class="equipos-config">
            <input
              type="text"
              id="nuevo-equipo"
              placeholder="Nombre del equipo (p.ej. Los Barbos)"
            />
            <button id="btn-add-equipo" class="btn-secondary">â¡ï¸ AÃ±adir equipo</button>
          </div>

          <div class="equipos-lista">
            <label>Equipos activos en esta temporada:</label>
            <ul id="lista-equipos">
              <!-- Se rellenarÃ¡ desde JS -->
            </ul>
            <small>Los equipos se pueden eliminar desde el panel de administrador.</small>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal de gestiÃ³n de equipos -->
    <div id="modal-equipos" class="modal-admin" style="display: none;">
      <div class="modal-overlay" id="modal-equipos-overlay"></div>
      <div class="modal-admin-content">
        <div class="modal-admin-header">
          <h3>ğŸ¤ GestiÃ³n de Equipos</h3>
          <button id="btn-cerrar-modal-equipos" class="btn-cerrar-menu">âœ•</button>
        </div>
        <div class="modal-admin-body">
          <div class="card-header" style="padding: 0; margin-bottom: 20px;">
            <p>Los equipos se comparten para toda la temporada. Gestiona los equipos que participan.</p>
          </div>

          <div class="equipos-config">
            <input
              type="text"
              id="nuevo-equipo-modal"
              placeholder="Nombre del equipo (p.ej. Los Barbos)"
            />
            <button id="btn-add-equipo-modal" class="btn-secondary">âœ AÃ±adir equipo</button>
          </div>

          <div class="equipos-lista">
            <label>Equipos activos en esta temporada:</label>
            <ul id="lista-equipos">
              <!-- Se rellenarÃ¡ desde JS -->
            </ul>
            <small>Los equipos se pueden eliminar desde el panel de administrador.</small>
          </div>
        </div>
      </div>
    </div>

    <main>
      <!-- Zona superior: selecciÃ³n de concurso -->
      <section class="card card-main">
        <div class="card-header">
          <h2>ğŸ¯ Elige concurso</h2>
          <p>Selecciona el concurso de pesca.</p>
        </div>

        <div class="concursos-filtros">
          <div class="form-group">
            <label for="select-concurso">Concurso activo</label>
            <select id="select-concurso"></select>
          </div>
        </div>

        <!-- InformaciÃ³n del concurso activo -->
        <div id="info-concurso-activo" style="margin-top: 20px; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; color: white; display: none;">
          <h3 style="margin-bottom: 16px; font-size: 1.2rem;">ğŸ¯ <span id="info-nombre">-</span></h3>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
            <div>
              <strong>ğŸ“… Fecha:</strong><br>
              <span id="info-fecha">-</span>
            </div>
            <div>
              <strong>ğŸ† Temporada:</strong><br>
              <span id="info-temporada">-</span>
            </div>
            <div>
              <strong>ğŸ“ Lugar:</strong><br>
              <span id="info-lugar">-</span>
            </div>
            <div>
              <strong>â° Hora:</strong><br>
              <span id="info-hora">-</span>
            </div>
            <div>
              <strong>ğŸ—ºï¸ Zonas:</strong><br>
              <div id="info-zonas" style="margin-top: 4px;">-</div>
            </div>
          </div>
        </div>
      </section>

      <!-- Formulario para aÃ±adir pesaje -->
      <section class="card">
        <div class="card-header">
          <h2>âš–ï¸ AÃ±adir pesaje</h2>
          <p>Registra los datos del concursante en el concurso activo.</p>
        </div>

        <form id="form-pesaje">
          <input type="hidden" id="registro-id-edicion" value="" />
          <div class="form-row">
            <div class="form-group">
              <label for="puesto">Puesto</label>
              <input
                type="number"
                id="puesto"
                name="puesto"
                required
                min="1"
                placeholder="NÂº de puesto"
              />
            </div>

            <div class="form-group">
              <label for="nombre">Nombre</label>
              <input
                type="text"
                id="nombre"
                name="nombre"
                required
                placeholder="Nombre"
              />
            </div>

            <div class="form-group">
              <label for="apellido1">Primer apellido</label>
              <input
                type="text"
                id="apellido1"
                name="apellido1"
                required
                placeholder="Primer apellido"
              />
            </div>

            <div class="form-group">
              <label for="apellido2">Segundo apellido (opcional)</label>
              <input
                type="text"
                id="apellido2"
                name="apellido2"
                placeholder="Segundo apellido"
              />
            </div>

            <div class="form-group" id="campo-zona-container">
              <label for="zona">Zona</label>
              <select id="zona" name="zona" required>
                <option value="">Selecciona zona</option>
                <!-- Opciones generadas dinÃ¡micamente -->
              </select>
            </div>

            <div class="form-group">
              <label for="equipo">ğŸ¤ Equipo (opcional)</label>
              <select id="equipo" name="equipo">
                <option value="">Sin equipo</option>
                <!-- Opciones generadas dinÃ¡micamente -->
              </select>
            </div>

            <div class="form-group">
              <label for="peso">Peso total (gramos)</label>
              <input
                type="number"
                id="peso"
                name="peso"
                required
                min="0"
                step="1"
                placeholder="Peso en gramos"
              />
            </div>
          </div>

          <div class="form-actions">
            <button type="submit" id="btn-guardar-pesaje" class="btn-primary full-width">
              ğŸ’¾ Guardar pesaje
            </button>
            <button type="button" id="btn-cancelar-edicion" class="btn-secondary full-width" style="display: none;">
              âŒ Cancelar ediciÃ³n
            </button>
          </div>
        </form>
      </section>

      <!-- Filtros -->
      <section class="card">
        <div class="card-header">
          <h2>ğŸ” Filtros</h2>
          <p>Ajusta la vista de clasificaciÃ³n individual.</p>
        </div>

        <div class="filters">
          <div class="form-group">
            <label for="filtro-zona">Ver por zona</label>
            <select id="filtro-zona">
              <option value="todas">Todas las zonas</option>
              <!-- Opciones generadas dinÃ¡micamente -->
            </select>
          </div>
        </div>
      </section>

      <!-- ClasificaciÃ³n individual del concurso activo -->
      <section class="card">
        <div class="card-header">
          <h2>ğŸ† ClasificaciÃ³n individual</h2>
          <p>Tabla clasificatoria del concurso y zona seleccionada.</p>
        </div>

        <div class="table-wrapper">
          <table id="tabla-clasificacion">
            <thead>
              <tr>
                <th>PosiciÃ³n Final</th>
                <th>Puesto</th>
                <th>Nombre</th>
                <th>Apellidos</th>
                <th>Zona</th>
                <th>Equipo</th>
                <th>Peso (g)</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              <!-- Filas generadas por JS -->
            </tbody>
          </table>
        </div>

        <div class="acciones">
          <button id="btn-exportar" class="btn-secondary">
            ğŸ“¤ Exportar clasificaciÃ³n a Excel
          </button>
          <button id="btn-imprimir-concurso" class="btn-secondary">
            ğŸ–¨ï¸ Imprimir clasificaciÃ³n
          </button>
        </div>

        <p class="resumen">
          ğŸ–ï¸ Concursante con mÃ¡s peso en la vista actual:
          <span id="top-concursante">Sin datos</span>
        </p>
      </section>

      <!-- ClasificaciÃ³n por equipos del concurso activo -->
      <section class="card card-equipos">
        <div class="card-header">
          <h2>ğŸ¤ ClasificaciÃ³n por equipos</h2>
          <p>Ranking de equipos del concurso actual (suma de pesos de todos los miembros).</p>
        </div>

        <div class="table-wrapper">
          <table id="tabla-clasificacion-equipos">
            <thead>
              <tr>
                <th>PosiciÃ³n</th>
                <th>Equipo</th>
                <th>Peso total (g)</th>
                <th>NÂº Miembros</th>
                <th>Promedio (g)</th>
              </tr>
            </thead>
            <tbody>
              <!-- Filas generadas por JS -->
            </tbody>
          </table>
        </div>

        <div id="mensaje-sin-equipos" class="no-data" style="display: none;">
          ğŸ¤ No hay equipos registrados en este concurso
        </div>
      </section>
    </main>

    <footer>
      <small>ğŸ£ Derechos de autor GGL - UniÃ³n de Pescadores de Plasencia</small>
    </footer>
  </div>

  <script src="app.js"></script>
</body>
</html>
